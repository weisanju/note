# 概述

sed命令应用广泛，使用简单，是快速文本处理的利器

![](../images/linux_sed.jfif)



# 参数

`-f`

参数指定一个sed脚本

`-n`

这个参数是--quiet或者--silent的意思。表明忽略执行过程的输出，只输出我们的结果即可。

`-i`

> 使用此参数后，所有改动将在原文件上执行。你的输出将覆盖原文件。**非常危险**，一定要注意。

# 范围

这个范围的指定很有灵性，请看以下示例（请自行替换图中的范围部分）。

> **5** 选择第5行。
>
> **2,5** 选择2到5行，共4行。
>
> **1~2** 选择奇数行。
>
> **2~2** 选择偶数行。
>
> **2,+3** 和2,5的效果是一样的，共4行。
>
> **2,$** 从第二行到文件结尾。

范围的选择还可以使用正则匹配。请看下面示例。

**/sys/,+3** 选择出现sys字样的行，以及后面的三行。

**/\^sys/,/mem/** 选择以sys开头的行，和出现mem字样行之间的数据。

```
sed -n '5p' file
sed -n '2,5 p' file
sed -n '1~2 p' file
sed -n '2~2 p' file
sed -n '2,+3p' file
sed -n '2,$ p' file
sed -n '/sys/,+3 p' file
sed -n '/^sys/,/mem/p' file
```

# 操作

最常用的操作就是p，意思就是打印。比如，以下两个命令就是等同的：

```
cat file 
sed -n 'p' file
```

除了打印，还有以下操作，我们来说常用的。

**p** 对匹配内容进行打印。

**d** 对匹配内容进行删除。这个时候就要去掉-n参数了，想想为什么。

**w** 将匹配内容写入到其他地方。

那么我想一次执行多个命令，还不想写sed脚本文件怎么办？那就需要加-e参数。sed的操作单元是行。







# 替换模式

以上是sed命令的常用匹配模式，但它还有一个强大的替换模式，意思就是查找替换其中的某些值，并输出结果。使用替换模式很少使用-n参数。

## 语法格式

![](../images/linux_sed_replace_mode.jfif)

## 参数解析

替换模式的参数有点多，但第一部分和第五部分都是可以省略的。替换后会将**整个文本**输出出来。



```
sed 's/a/b/g' file
sed 's/[a,b,c]/<&>/g' file#这个命令我们下面解释
```

**&**号，再重复一遍。当它用在替换字符串中的时候，代表的是原始的查找匹配数据。

> **[&]** 表明将查找到的数据使用[]包围起来。
>
> **“&”** 表明将查找的数据使用””包围起来。

下面这条命令，将会把文件中的每一行，使用引号包围起来。

```
sed 's/.*/"&"/' file
```



flag 参数

**g** 默认只匹配行中第一次出现的内容，加上g，就可以全文替换了。常用。

**p** 当使用了-n参数，p将仅输出匹配行内容。

**w** 和上面的w模式类似，但是它仅仅输出有变换的行。

**i** 这个参数比较重要，表示忽略大小写。

**e** 表示将输出的每一行，执行一个命令。不建议使用，可以使用xargs配合完成这种功能。



看两个命令的语法：

```
sed -n 's/a/b/gipw output.txt' file
sed 's/^/ls -la/e' file
```

由于正则的关系，很多字符需要转义。你会在脚本里做些很多\\，\*之类的处理。你可以使用|^@!四个字符来替换\。

比如，下面五个命令是一样的。

```
sed '/aaa/s/\/etc/\/usr/g' file
sed '/aaa/s@/etc@/usr@g' file
sed '/aaa/s^/etc^/usr^g' file
sed '/aaa/s|/etc|/usr|g' file
sed '/aaa/s!/etc!/usr!g' file
```



# Example

**输出长度不小于50个字符的行**

```
sed -n '/^.{50}/p'
```

**统计文件中有每个单词出现了多少次**

```
sed 's/ /\n/g' file | sort | uniq -c
```

**查找目录中的py文件，删掉所有行级注释**

```
find ./ -name "*.py" | xargs sed -i.bak '/^[ ]*#/d'
```

**查看第5-7行和10-13行**

```
sed -n -e '5,7p' -e '10,13p' file
```

**仅输出ip地址**

```
ip route show | sed -n '/src/p' | sed -e 's/ */ /g' | cut -d' ' -f9
```



Do you want to proceed with the proposed reshard plan