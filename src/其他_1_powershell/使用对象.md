# 查看对象结构 (Get-Member)

## 示例

```powershell
Get-Process | Get-Member | Out-Host -Paging
```

```powershell
Get-Process | Get-Member -MemberType Properties

Get-Process | Get-Member -m Properties
```





# 选择对象的部门属性

> # Select-Object

```powershell
//获取磁盘空间
Get-CimInstance -Class Win32_LogicalDisk | Select-Object -Property Name,FreeSpace
```

```powershell
Get-CimInstance -Class Win32_LogicalDisk |
  Select-Object -Property Name, @{
    label='FreeSpace'
    expression={($_.FreeSpace/1GB).ToString('F2')}
  }
```



# 从管道删除对象

> ##  Where-Object

**FilterScript 值是计算结果为 True 或 False 的脚本块 ，即由大括号 (`{}`) 括起来的一个或多个 PowerShell 命令**

**示例**

```powershell
Get-CimInstance -Class Win32_SystemDriver |
  Where-Object {$_.State -eq 'Running'}
  
Get-CimInstance -Class Win32_SystemDriver |
  Where-Object {$_.State -eq "Running"} |
    Where-Object {$_.StartMode -eq "Auto"}
    
Get-CimInstance -Class Win32_SystemDriver |
  Where-Object {$_.State -eq "Running"} |
    Where-Object {$_.StartMode -eq "Manual"} |
      Format-Table -Property Name,DisplayName
      
      
Get-CimInstance -Class Win32_SystemDriver |
  Where-Object {($_.State -eq 'Running') -and ($_.StartMode -eq 'Manual')} |
    Format-Table -Property Name,DisplayName
    
```

**逻辑连接符**

| 逻辑运算符 | 含义                                        | 示例（返回 True）        |
| :--------- | :------------------------------------------ | :----------------------- |
| -and       | Logical and；如果两侧都为 True，则返回 True | (1 -eq 1) -and (2 -eq 2) |
| -or        | Logical or；如果某一侧为 True，则返回 True  | (1 -eq 1) -or (1 -eq 2)  |
| -not       | Logical not；反转 True 和 False             | -not (1 -eq 2)           |
| !          | Logical not；反转 True 和 False             | !(1 -eq 2)               |



# 对象排序

> Sort-Object

**默认升序排序**

```powershell
Get-ChildItem |
  Sort-Object -Property LastWriteTime, Name |
  Format-Table -Property LastWriteTime, Name
```

**降序**

```powershell
Get-ChildItem |
  Sort-Object -Property LastWriteTime, Name -Descending |
  Format-Table -Property LastWriteTime, Name
```

**表达式排序**

```powershell
Get-ChildItem |
  Sort-Object -Property @{ Expression = 'LastWriteTime'; Descending = $true }, @{ Expression = 'Name'; Ascending = $true } |
  Format-Table -Property LastWriteTime, Name
  
Get-ChildItem |
  Sort-Object -Property @{ Expression = { $_.LastWriteTime - $_.CreationTime }; Descending = $true } |
  Format-Table -Property LastWriteTime, CreationTime
```



**简写形式**

```powershell
Sort-Object LastWriteTime, Name
sort LastWriteTime, Name

Sort-Object @{ e = 'LastWriteTime'; d = $true }, @{ e = 'Name'; a = $true }
```

**变量提取**

```powershell
$order = @(
  @{ Expression = 'LastWriteTime'; Descending = $true }
  @{ Expression = 'Name'; Ascending = $true }
)

Get-ChildItem |
  Sort-Object $order |
  Format-Table LastWriteTime, Name
```



# 重复执行

> # ForEach-Object

```powershell
Get-CimInstance -Class Win32_LogicalDisk |
  ForEach-Object -Process {($_.FreeSpace)/1MB}
```





# 创建 .NET 和 COM 对象 

>  (New-Object)

**.NET 对象**

```
.NET Framework 类库包括一个名为 **System.Diagnostics.EventLog** 的类，该类可用于管理事件日志。 可以通过使用具有 **TypeName** 参数的 **New-Object** cmdlet 创建 .NET Framework 类的新实例。 例如，以下命令将创建事件日志引用：
```

```powershell
New-Object -TypeName System.Diagnostics.EventLog

New-Object -TypeName System.Diagnostics.EventLog -ArgumentList Application
```

**变量保存对象**

```powershell
 $AppLog = New-Object -TypeName System.Diagnostics.EventLog -ArgumentList Application
```

**使用 New-Object 创建 COM 对象**

```powershell
New-Object -ComObject WScript.Shell
New-Object -ComObject WScript.Network
New-Object -ComObject Scripting.Dictionary
New-Object -ComObject Scripting.FileSystemObject
```

**使用 WScript.Shell 创建桌面快捷方式**

```powershell
$WshShell = New-Object -ComObject WScript.Shell

 $WshShell | Get-Member
 
 Get-Member -InputObject $a //-InputObject 会将参数当作一个对象
```

**Windows PowerShell 使用 Internet Explorer**

```powershell
$ie = New-Object -ComObject InternetExplorer.Application
```

# 使用静态类和方法

## **使用 System.Environment 获取环境数据**

**引用静态的 System.Environment 类**

```powershell
[System.Environment]::Commandline
```

## 使用 System.Math 做数学

```powershell
[System.Math] | Get-Member -Static -MemberType Methods
PS> [System.Math]::Sqrt(9)
3
PS> [System.Math]::Pow(2,3)
8
PS> [System.Math]::Floor(3.3)
3
PS> [System.Math]::Floor(-3.3)
-4
PS> [System.Math]::Ceiling(3.3)
4
PS> [System.Math]::Ceiling(-3.3)
-3
PS> [System.Math]::Max(2,7)
7
PS> [System.Math]::Min(2,7)
2
PS> [System.Math]::Truncate(9.3)
9
PS> [System.Math]::Truncate(-9.3)
-9
```



# 获取 WMI 对象 (Get-CimInstance)

## 获取 WMI 对象 (Get-CimInstance)

Windows Management Instrumentation (WMI) 是 Windows 系统管理的核心技术，因为它以统一的方式公开大量信息。 由于 WMI 可实现的效果，用于访问 WMI 对象的 PowerShell cmdlet `Get-CimInstance` 是进行**实际工作最有用的对象之一**。 我们将讨论如何使用 CimCmdlets 访问 WMI 对象以及如何使用 WMI 对象执行特定操作。

## 列出 WMI 类

大多数 WMI 用户遇到的第一个问题就是尝试了解 WMI 可执行的操作。 WMI 类描述了可管理的资源。 有成百上千的 WMI 类，其中一些包含数十个属性。

```powershell
Get-CimClass -Namespace root/CIMV2 |
  Where-Object CimClassName -like Win32* |
    Select-Object CimClassName
```

**获取远程计算机信息**

```powershell
Get-CimClass -Namespace root/CIMV2 -ComputerName 192.168.1.29
```

**显示 WMI 类详细信息**

```powershell
Get-CimInstance -Class Win32_OperatingSystem
```

尽管我们显示了所有参数，但可以用更简洁的方式表达该命令。 连接到本地系统时不需要使用 **ComputerName** 参数。 我们显示它是为了演示最常见的情况以及提醒与参数有关的事项。 Namespace 默认为 `root/CIMV2`，也可以省略。 最后，大多数 cmdlet 都允许省略通用参数的名称。 使用 `Get-CimInstance` 时，如果未指定第一个参数的名称，则 PowerShell 会将其视为 Class 参数。 这意味着最后一个命令可能是通过键入以下内容发出的：

```powershell
Get-CimInstance Win32_OperatingSystem
```

**通过 Format Cmdlet 显示非默认属性**

```powershell
Get-CimInstance -Class Win32_OperatingSystem |
  Format-Table -Property TotalVirtualMemorySize, TotalVisibleMemorySize,
    FreePhysicalMemory, FreeVirtualMemory, FreeSpaceInPagingFiles
```

由于通配符支持 `Format-Table` 中的属性名，因此最终管道元素可缩减为 `Format-Table -Property Total*Memory*, Free*`

```powershell
Get-CimInstance -Class Win32_OperatingSystem | Format-List Total*Memory*, Free*
```

